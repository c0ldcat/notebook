<!--
    vi: ft=pandoc.markdown
-->

# CPU

## 功能

* 指令控制: 保证机器按程序规定的顺序取出执行
* 操作控制: CPU产生每条指令所对应的操作信号，并把各种操作信号送往相应的部件，从而控制这些部件按指令的要求进行动作
* 时间控制: 对各种操作的实施时间进行定时
* 数据加工: 对数据进行算术运算和逻辑运算处理

## 主要寄存器

数据缓冲寄存器(DR)
: 暂时存放由内存读出或写入的指令或数据字

指令寄存器(IR)
: 保存当前正在执行的一条指令

程序计数器(PC)
: 确定下一条指令的地址

地址寄存器(AR)
: 保存当前CPU所访问的内存单元的地址

通用寄存器(R0～R3)
: \ 

状态条件寄存器(PSW)
: 保存由算术和逻辑指令的结果建立的各种条件码

## 指令系统

指令 = 微程序(ADD) > n条微指令(PC -> AR) > m条微命令(PC, G, AR) = 微操作(PC, G, AR)

### 指令周期

指令周期 > CPU周期 > 时钟周期

### 控制方式

* 同步控制方式（指令的机器周期和时钟周期数不变）
  * 完全统一的机器周期执行各种不同的指令
  * 采用不定长机器周期
  * 中央控制于局部控制的结合
* 异步控制方式
  * 每条指令需要多长时间就占多长时间
* 联合控制方式
  * 大部分指令在固定的周期内完成，少数难以确定的操作采用异步方式
  * 机器周期的节拍脉冲固定，但是各指令的机器周期数不固定（微程序控制器采用）

### 微程序

采用存储程序原理，需要执行多条微指令，速度较慢

硬布线控制器
: 用布尔代数写出逻辑表达式，然后用门电路、触发器等器件实现, 速度快, 不容易修改新添功能

### 微指令

#### 微地址转移

##### 计数器方式

PC自加1, 寄存器-PC

顺序控制字段短, 机制简单. 功能弱, 速度慢, 灵活性差

##### 多路转移方式

一条微指令具有转移多个转移分支的能力

按顺序控制字段的“判别测试”标志和“状态条件”信息来选择其中一个微地址

#### 转换微命令

##### 水平型微指令

[控制字段, 判别测试字段, 下地址字段]

指一次能定义并能并行执行多个微命令的微指令

##### 垂直形微指令

[操作码字段、源地址字段、目的地址字段]

同时操作的微命令种类和数目加以适当的限制

##### 控制字段编码方式

* 直接编码
* 编码表示
* 混合表示

## 流水CPU

### 并行技术

1. **时间并行**
2. 空间并行
3. 时间并行+空间并行

### 结构

1. 指令部件
2. 指令队列
3. 执行部件
   
### 问题

1. 资源相关
2. 数据相关: RAW, WAR, WAW
3. 控制相关: (控制PC的分支指令)

## RISC, CISC

RISC指令系统是CISC指令系统的改进，它的最大特点是：

1. 指令条数少
2. 指令长度固定，指令格式和寻址方式种类少
3. 只有取数/存数指令访问存储器，其余指令的操作均在寄存器之间进行
4. 大量通用寄存器
5. 流水线优化

* 奔腾CPU是流水CPU的CISC机器